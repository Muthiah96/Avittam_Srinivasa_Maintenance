<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Avittam Srinivasa Apartment Portal</title>

  <link rel="stylesheet" href="style.css?v=7" />
  <meta name="theme-color" content="#f59e0b" />
</head>
<body>
  <!-- Full-screen loader -->
  <div id="loader" class="loader-overlay" aria-busy="true" aria-live="polite">
    <div class="loader-card">
      <div class="spinner" role="status" aria-label="Loading"></div>
      <p class="loader-text">Loading dashboardâ€¦</p>
    </div>
  </div>

  <!-- App (hidden until data loads) -->
  <div id="app" class="hidden">
    <header class="hero">
      <div class="stripe"></div>
      <h1>Avittam Srinivasa Apartment Portal</h1>
    </header>

    <!-- Sticky nav with CAC pill -->
    <nav class="topnav" role="navigation" aria-label="Primary">
      <a href="#dashboard">Dashboard</a>
      <a href="#opl">OPL</a>
      <span class="nav-cac" title="Common Area Controller">
        <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 5l9-3 9 3v6c0 5-3.8 9.7-9 11-5.2-1.3-9-6-9-11V5z" fill="currentColor"/>
        </svg>
        <span id="cac-text">Common Area Controller: â€”</span>
      </span>
    </nav>

    <!-- Error bar (hidden by default) -->
    <div id="error" class="error-banner hidden" role="alert"></div>

    <main class="container" role="main">
      <!-- Dashboard -->
      <section id="dashboard" class="panel" aria-labelledby="dashboard-title">
        <h2 id="dashboard-title">
          Dashboard â€” <span id="dash-month"></span>
        </h2>

        <div class="stat-columns">
          <!-- Column 1 -->
          <div class="col">
            <!-- Maintenance -->
            <div class="stat-group">
              <h3><span class="emoji">ðŸ”§</span>Maintenance</h3>
              <div class="stat-list">
                <button class="stat-item linklike" id="btn-paid" type="button">
                  <span>Paid (Flats)</span>
                  <strong id="paid-count">0</strong>
                  <small>Click to view list</small>
                </button>
                <button class="stat-item linklike" id="btn-pending" type="button">
                  <span>Pending (Flats)</span>
                  <strong id="pending-count">0</strong>
                  <small>Click to view list</small>
                </button>
              </div>

              <details class="details">
                <summary>Maintenance details (per flat)</summary>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr>
                        <th>Apt</th>
                        <th>Maintenance Amount</th>
                        <th>Paid?</th>
                      </tr>
                    </thead>
                    <tbody id="apt-table-maint"></tbody>
                  </table>
                </div>
              </details>
            </div>

            <!-- Sweeper -->
            <div class="stat-group">
              <h3><span class="emoji">ðŸ§¹</span>Sweeper</h3>
              <div class="stat-list">
                <div class="stat-item">
                  <span>Amount (This Month)</span>
                  <strong id="maid-amount">â€”</strong>
                  <small>Month: <span id="dash-month-maid"></span></small>
                </div>
                <div class="stat-item">
                  <span>Leaves</span>
                  <strong id="maid-leaves">â€”</strong>
                </div>
                <div class="stat-item">
                  <span>Payment</span>
                  <strong id="maid-paid">â€”</strong>
                </div>
              </div>
            </div>
          </div>

          <!-- Column 2 -->
          <div class="col">
            <!-- EB -->
            <div class="stat-group">
              <h3><span class="emoji">âš¡</span>EB</h3>
              <div class="stat-list">
                <div class="stat-item">
                  <span>Amount (Common)</span>
                  <strong id="eb-amount">â€”</strong>
                  <small id="eb-amount-note"></small>
                </div>
                <div class="stat-item">
                  <span>Status</span>
                  <strong id="eb-paid">â€”</strong>
                  <small>Month: <span id="dash-month-eb"></span></small>
                </div>
                <div class="stat-item">
                  <span>Next EB Period</span>
                  <strong id="eb-next">â€”</strong>
                </div>
              </div>
            </div>

            <!-- Lift -->
            <div class="stat-group">
              <h3><span class="emoji">ðŸ›—</span>Lift Details</h3>
              <div class="stat-list">
                <div class="stat-item status" id="row-ins">
                  <div class="row-main">
                    <span>Insurance</span>
                    <strong id="lift-ins-paid">â€”</strong>
                  </div>
                  <div class="row-sub">
                    <small>Valid Until</small>
                    <strong id="lift-ins-valid">â€”</strong>
                    <small id="lift-ins-days"></small>
                  </div>
                </div>
                <div class="stat-item status" id="row-amc">
                  <div class="row-main">
                    <span>AMC</span>
                    <strong id="lift-amc-paid">â€”</strong>
                  </div>
                  <div class="row-sub">
                    <small>Valid Until</small>
                    <strong id="lift-amc-valid">â€”</strong>
                    <small id="lift-amc-days"></small>
                  </div>
                </div>
              </div>
            </div>

            <!-- Balance -->
            <div class="stat-group">
              <h3><span class="emoji">ðŸ’°</span>Balance</h3>
              <div class="stat-list">
                <a
                  class="stat-item linklike"
                  id="link-balance"
                  href="https://docs.google.com/spreadsheets/d/1vGhGbTScu8bdkP2xLb31vuPYKfjv_E6aKCqYwGAHcN0/edit"
                  target="_blank"
                  rel="noopener"
                >
                  <span>Available (Total âˆ’ Expenses)</span>
                  <strong id="bal-available">â€”</strong>
                  <small>
                    Total: <span id="bal-total-inline">â€”</span>
                    â€¢ Expenses: <span id="bal-expenses-inline">â€”</span>
                  </small>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- OPL -->
      <section class="panel" id="opl" aria-labelledby="opl-title">
        <h2 id="opl-title">OPL (Open Points)</h2>

        <div class="stat-list two">
          <div class="stat-item">
            <span>Open Items</span>
            <strong id="opl-open-count">â€”</strong>
          </div>
          <div class="stat-item">
            <span>Closed Items</span>
            <strong id="opl-closed-count">â€”</strong>
          </div>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Title / Issue</th>
                <th>Status</th>
                <th>Apt</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody id="opl-table"></tbody>
          </table>
        </div>
        <div class="right">
          <button id="opl-more" type="button">View full list</button>
        </div>
      </section>
    </main>

    <footer>
      <p>Â© <span id="year"></span> Avittam Srinivasa Apartment Association</p>
    </footer>

    <!-- Modal -->
    <div id="modal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true">
      <div class="modal-backdrop" id="modal-close"></div>
      <div class="modal-card">
        <button class="modal-x" id="modal-x" aria-label="Close">Ã—</button>
        <h3 id="modal-title">Details</h3>
        <div id="modal-content">
          <ul id="modal-list"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="script.js?v=41"></script>
</body>
</html>
